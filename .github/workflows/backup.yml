name: Backup N8N

on:
  schedule:
    - cron: "0 3 * * *"   # Backup diário às 03:00
  workflow_dispatch:      # Permite rodar manualmente

jobs:
  backup-n8n:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout (obrigatório para scp)
        uses: actions/checkout@v4

      - name: Enviar backup para VPS
        uses: appleboy/scp-action@v0.1.5
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          source: "/home/n8n/.n8n"       # << O que será enviado
          target: "/backups/n8n"         # << Onde salvar na VPS
          overwrite: true
          rm: false                      # Nunca apagar nada do servidor
          tar_tmp_path: "/tmp"

